<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ImaKOL</title>
    <!-- DaisyUI and Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <style>
        body {
            overscroll-behavior: none; /* Prevents pull-to-refresh on mobile */
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f27474 0%, #f2a274 100%);
        }
        .camera-button {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .preview-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px 0;
            scroll-snap-type: x mandatory;
        }
        .preview-item {
            scroll-snap-align: start;
            flex: 0 0 auto;
            position: relative;
        }
        .capture-area {
            min-height: 150px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div x-data="app()" class="flex flex-col items-center justify-between h-screen p-4">
        <!-- Header -->
        <div class="flex flex-col items-center mt-10 w-full">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full gradient-bg mr-2"></div>
                <h1 class="text-3xl font-bold"><span>Ima</span><span class="text-rose-400">KOL</span></h1>
            </div>
            <p class="text-gray-600 mt-2 text-center">Capture and share your moments</p>
        </div>

        <!-- Main content area -->
        <div class="w-full flex-1 flex flex-col justify-center items-center overflow-hidden my-4" :class="{'hidden': step !== 'main'}">
            <div class="flex gap-4 mt-4">
                <button @click="openCamera()" class="btn gradient-bg text-white border-none px-8 py-2 rounded-full shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Capture
                </button>
                <label class="btn bg-white text-gray-800 border-gray-200 px-8 py-2 rounded-full shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    Upload
                    <input type="file" class="hidden" @change="handleFileUpload" accept="image/*,video/*" multiple>
                </label>
            </div>
        </div>

        <!-- Preview & Upload Area -->
        <div class="w-full flex-1 flex flex-col justify-between overflow-hidden" :class="{'hidden': step !== 'preview'}">
            <div class="mb-4">
                <h2 class="text-xl font-semibold mb-2">Preview</h2>
                <div class="preview-container">
                    <template x-for="(file, index) in files" :key="index">
                        <div class="preview-item w-24 h-24 relative">
                            <template x-if="file.type.includes('image')">
                                <img :src="file.preview" class="w-full h-full object-cover rounded-lg">
                            </template>
                            <template x-if="file.type.includes('video')">
                                <div class="w-full h-full bg-gray-900 rounded-lg flex items-center justify-center">
                                    <video :src="file.preview" class="w-full h-full object-cover rounded-lg"></video>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white absolute" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            </template>
                            <button @click="removeFile(index)" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">
                                Ã—
                            </button>
                        </div>
                    </template>
                </div>
                <div class="flex gap-4 mt-4">
                    <label class="btn bg-white text-gray-800 border-gray-200 px-6 py-2 rounded-full shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        Add More
                        <input type="file" class="hidden" @change="handleFileUpload" accept="image/*,video/*" multiple>
                    </label>
                </div>
            </div>
            <div class="w-full mb-4">
                <button @click="processFiles()" class="btn gradient-bg text-white border-none w-full py-3 rounded-full shadow-lg">
                    <template x-if="!isProcessing">
                        <span>Enhance & Create Post</span>
                    </template>
                    <template x-if="isProcessing">
                        <div class="flex items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Processing...
                        </div>
                    </template>
                </button>
            </div>
        </div>

        <!-- Final Post View -->
        <div class="w-full flex-1 flex flex-col overflow-hidden" :class="{'hidden': step !== 'post'}">
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-4 w-full">
                <div class="p-4">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 rounded-full gradient-bg"></div>
                        <div class="ml-3">
                            <p class="font-semibold">ImaKOL User</p>
                            <p class="text-xs text-gray-500">Just now</p>
                        </div>
                    </div>
                    <p class="text-gray-800 mb-4" x-text="caption"></p>
                </div>
                <div class="relative aspect-square bg-gray-100">
                    <template x-if="files.length > 0">
                        <div>
                            <template x-if="files[0].type.includes('image')">
                                <img :src="files[0].preview" class="w-full h-full object-cover">
                            </template>
                            <template x-if="files[0].type.includes('video')">
                                <video :src="files[0].preview" class="w-full h-full object-cover" controls></video>
                            </template>
                            <div x-show="files.length > 1" class="absolute bottom-3 right-3 bg-gray-800 bg-opacity-70 text-white px-2 py-1 rounded-md text-sm">
                                +<span x-text="files.length - 1"></span> more
                            </div>
                        </div>
                    </template>
                </div>
                <div class="flex p-4">
                    <button class="btn gradient-bg text-white border-none w-full py-3 rounded-full shadow-lg" @click="sharePost()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                        </svg>
                        Share Post
                    </button>
                </div>
            </div>
            <button @click="resetApp()" class="btn btn-outline w-full mb-4">Create Another Post</button>
        </div>

        <!-- Camera component -->
        <div x-show="step === 'camera'" class="fixed inset-0 bg-black z-50 flex flex-col">
            <div class="p-4 flex justify-between items-center">
                <button @click="closeCamera()" class="text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div class="text-white">Camera</div>
                <div class="w-6"></div>
            </div>
            <div class="flex-1 relative">
                <video id="camera-feed" class="w-full h-full object-cover"></video>
            </div>
            <div class="p-6 flex justify-center">
                <button @click="takePhoto()" class="w-16 h-16 rounded-full border-4 border-white flex items-center justify-center">
                    <div class="w-12 h-12 rounded-full bg-white"></div>
                </button>
            </div>
        </div>

        <!-- Bottom camera button (shown only on main screen) -->
        <div class="fixed bottom-10 left-1/2 transform -translate-x-1/2" x-show="step === 'main'">
            <button @click="openCamera()" class="w-16 h-16 rounded-full gradient-bg camera-button flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>
    </div>

    <script>
        function app() {
            return {
                step: 'main', // main, preview, camera, post
                files: [],
                isProcessing: false,
                caption: '',
                videoStream: null,
                grokApiKey: 'xai-bNdcB9vLeicNoDwv8obQhn71ZKP3p7W39oeEeDZFWmhzASEFnjdvVz6C1HYzQns20Ct7R1DeZRk70M1F',
                
                // File handling
                handleFileUpload(event) {
                    const newFiles = Array.from(event.target.files);
                    if (newFiles.length > 0) {
                        newFiles.forEach(file => {
                            // Create a preview URL
                            const preview = URL.createObjectURL(file);
                            this.files.push({
                                file: file,
                                preview: preview,
                                type: file.type
                            });
                        });
                        this.step = 'preview';
                    }
                },
                
                removeFile(index) {
                    URL.revokeObjectURL(this.files[index].preview);
                    this.files.splice(index, 1);
                    
                    if (this.files.length === 0) {
                        this.step = 'main';
                    }
                },
                
                // Camera functions
                async openCamera() {
                    try {
                        this.step = 'camera';
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: {
                                facingMode: 'environment', // Use back camera on mobile
                                width: { ideal: 1920 },
                                height: { ideal: 1080 }
                            },
                            audio: false
                        });
                        
                        this.videoStream = stream;
                        const videoElement = document.getElementById('camera-feed');
                        videoElement.srcObject = stream;
                        videoElement.play();
                    } catch (error) {
                        console.error('Error accessing camera: ', error);
                        alert('Could not access camera. Please ensure camera permissions are granted.');
                        this.step = 'main';
                    }
                },
                
                closeCamera() {
                    if (this.videoStream) {
                        this.videoStream.getTracks().forEach(track => track.stop());
                        this.videoStream = null;
                    }
                    this.step = 'main';
                },
                
                takePhoto() {
                    const videoElement = document.getElementById('camera-feed');
                    
                    // Create a canvas to capture the frame
                    const canvas = document.createElement('canvas');
                    canvas.width = videoElement.videoWidth;
                    canvas.height = videoElement.videoHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                    
                    // Convert canvas to blob
                    canvas.toBlob(blob => {
                        const preview = URL.createObjectURL(blob);
                        this.files.push({
                            file: blob,
                            preview: preview,
                            type: 'image/jpeg'
                        });
                        
                        // Stop camera and go to preview
                        this.closeCamera();
                        this.step = 'preview';
                    }, 'image/jpeg', 0.9);
                },
                
                // Processing functions
                async processFiles() {
                    if (this.files.length === 0) return;
                    
                    this.isProcessing = true;
                    
                    try {
                        // Simulate enhancement (in a real app, you would send to your backend)
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Prepare files for Grok API
                        const imageData = await this.prepareImagesForGrok();
                        
                        // Call Grok Vision API
                        const generatedCaption = await this.callGrokVisionAPI(imageData);
                        this.caption = generatedCaption;
                        
                        // Move to post view
                        this.step = 'post';
                    } catch (error) {
                        console.error('Error processing files:', error);
                        alert('There was an error processing your files. Please try again.');
                    } finally {
                        this.isProcessing = false;
                    }
                },
                
                async prepareImagesForGrok() {
                    // Convert the first image to Base64 (in a real app, you might want to do this for all images)
                    // For demonstration, we'll just use the first image
                    if (this.files.length === 0) return null;
                    
                    const file = this.files[0].file;
                    if (!file.type.includes('image')) {
                        // Just return placeholder for videos - in a real app, you might extract frames
                        return "This is a video";
                    }
                    
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            resolve(e.target.result);
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                },
                
                async callGrokVisionAPI(imageData) {
                    try {
                        // For security, in a production app, this API call should be made from a server
                        // This is for demonstration purposes only, as client-side API calls expose your API key
                        
                        if (!imageData) {
                            return "Amazing video capture! Share this moment with your friends.";
                        }

                        // For demo purposes, we'll simulate the API call
                        // In a real application, you would make an actual API call to Grok

                        // Simulating a delay to represent API call time
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Generate a simulated response (in a real app, this would come from Grok API)
                        const captions = [
                            "Capturing the beauty of the moment with friends! #LifeMemories",
                            "Exploring new adventures and making memories to cherish forever!",
                            "Perfect day for creating unforgettable moments with loved ones.",
                            "The colors, the energy, the joy - all in one perfect shot!",
                            "Some moments are just too beautiful not to share. #ImaKOL"
                        ];
                        
                        return captions[Math.floor(Math.random() * captions.length)];
                        
                        /* To implement the actual Grok API call, you would use code like this:
                        
                        const response = await fetch('https://api.grok.ai/v1/vision/analyze', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.grokApiKey}`
                            },
                            body: JSON.stringify({
                                image: imageData,
                                prompt: "Generate a catchy, engaging social media caption for this image"
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }

                        const data = await response.json();
                        return data.caption || data.text || "Check out my latest post!";
                        */
                    } catch (error) {
                        console.error('Error calling Vision API:', error);
                        return "Amazing capture! Share this moment with your friends.";
                    }
                },
                
                sharePost() {
                    // In a real app, this would integrate with the device's share functionality
                    // For this demo, we'll just show an alert
                    
                    // Check if Web Share API is supported
                    if (navigator.share) {
                        navigator.share({
                            title: 'My ImaKOL Post',
                            text: this.caption,
                        })
                        .then(() => console.log('Post shared successfully'))
                        .catch((error) => {
                            console.error('Error sharing:', error);
                            alert('Could not share the post. You might need to save the image and share manually.');
                        });
                    } else {
                        alert('Sharing is not supported on this device/browser. You can save the image and share manually.');
                    }
                },
                
                resetApp() {
                    // Clean up resources
                    this.files.forEach(file => URL.revokeObjectURL(file.preview));
                    
                    // Reset state
                    this.files = [];
                    this.caption = '';
                    this.isProcessing = false;
                    this.step = 'main';
                }
            };
        }
    </script>
</body>
</html> 